# Use `Cython` to Protect Source Code

When you use `uv pip install` to install your project into `pyembed/python`, your Python code is distributed **as-is**.

If you want to protect your source code, you can use [`Cython`](https://github.com/cython/cython/) or [`Nuitka`](https://github.com/Nuitka/Nuitka/) to compile your Python code into binary modules.

We recommend `Cython` because it integrates well with the `setuptools` used by PyTauri.

![cythonized](https://github.com/user-attachments/assets/d4ecc6ae-b27f-4b8a-ad3e-28d406cd6ead)

## Usage

First, ensure that you meet the [prerequisites](https://cython.readthedocs.io/en/latest/src/quickstart/install.html#installing-cython) for `Cython`.

Then, add `Cython` as a build dependency:

```toml title="src-tauri/pyproject.toml"
[build-system]
requires = [
    # ...
    "Cython >= 3, <4",
]
build-backend = "setuptools.build_meta"
```

Add the following content to `setup.py`. Pay attention to the following parameters and their comments:

- `USE_CYTHON`
- `SRC_PREFIX`
- `INCLUDE_FILE_PATTERNS`
- `EXCLUDE_FILE_PATTERNS`

```python title="src-tauri/setup.py"
--8<-- "docs_src/tutorial/build_standalone/cython/setup.py"
```

> Add `*.c` (generated by `Cython`) to `.gitignore` to avoid committing them if you don't want to.

When building a standalone binary (`uv pip install`), you only need to add the environment variable `USE_CYTHON=1` to compile your Python code with `Cython`.

Check the following directories, and you will find that the `*.py` source files matching `INCLUDE_FILE_PATTERNS` have been compiled into `*.so`/`*.pyd` files. Additionally, the `*.c` files generated by `Cython` (which could also leak your source code) are not included:

- Windows: `src-tauri\pyembed\python\Lib\site-packages\{your_package}`
- Unix: `src-tauri/pyembed/python/lib/python{version}/site-packages/{your_package}`

!!! tip
    During development, you can still use `uv pip install -e` to install your project in development mode. This means you can modify `*.py` files and see the changes immediately (without compiling with `Cython`). That's awesome ðŸŽ‰!

## FAQ

### The Size of the Binary Modules

It is not recommended to set `INCLUDE_FILE_PATTERNS` to a wildcard like `**/*.py`. Compiling a binary module can increase your application size from a few kilobytes for `*.py` files to several hundred kilobytes. Of course, if you don't mind the size increase, this is not an issue.

If you do want to do this and still care about size, check out the `Cython` tutorial (NOTE: it is complex and requires manual steps): <https://cython.readthedocs.io/en/latest/src/userguide/source_files_and_compilation.html#shared-utility-module>

If possible, consider consolidating the code you want to compile into a single file. This not only reduces size but also allows `Cython` to better optimize and accelerate them through inlining: <https://cython.readthedocs.io/en/latest/src/userguide/faq.html#what-is-better-a-single-big-module-or-multiple-separate-modules>.

### Why Hack the `setuptools.command.install.install`

Setuptools does not provide an API to exclude certain files from the Wheel: <https://github.com/pypa/setuptools/issues/511>.
